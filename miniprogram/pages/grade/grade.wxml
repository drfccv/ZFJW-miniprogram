<!--æˆç»©æŸ¥è¯¢é¡µé¢-->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">æˆç»©æŸ¥è¯¢</text>
    <text class="update-time" wx:if="{{lastUpdateTime}}">{{lastUpdateTime}}</text>
  </view>

  <!-- å­¦æœŸé€‰æ‹©å™¨ -->
  <view class="term-selector"><!-- å­¦å¹´é€‰æ‹©å™¨ -->
    <picker
      class="hidden-picker" 
      mode="selector"
      range="{{yearRange}}"
      value="{{yearIndex}}"
      bindchange="onYearChange"
    >
      <view class="selector-item">
        <text class="selector-label">å­¦å¹´:</text>
        <text class="selector-value">{{yearRange[yearIndex]}}</text>
        <text class="selector-arrow">â–¼</text>
      </view>
    </picker><!-- å­¦æœŸé€‰æ‹©å™¨ -->
    <picker
      class="hidden-picker"
      mode="selector"
      range="{{['ç¬¬ä¸€å­¦æœŸ', 'ç¬¬äºŒå­¦æœŸ']}}"
      value="{{termIndex}}"
      bindchange="onTermChange"
    >
      <view class="selector-item">
        <text class="selector-label">å­¦æœŸ:</text>
        <text class="selector-value">{{termIndex === 0 ? 'ç¬¬ä¸€å­¦æœŸ' : 'ç¬¬äºŒå­¦æœŸ'}}</text>
        <text class="selector-arrow">â–¼</text>
      </view>
    </picker>

    <view class="refresh-btn" bindtap="refreshGrades">
      <text class="refresh-icon">ğŸ”„</text>
    </view>
  </view>  <!-- æˆç»©ç»Ÿè®¡ -->
  <view class="grade-stats" wx:if="{{gradeList.length > 0}}">
    <!-- ç¬¬ä¸€è¡Œç»Ÿè®¡ -->
    <view class="stats-row">
      <view class="stat-item">
        <text class="stat-value">{{gradeStats.totalCourses}}</text>
        <text class="stat-label">æ€»ç§‘ç›®</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{gradeStats.passedCourses}}</text>
        <text class="stat-label">é€šè¿‡</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{gradeStats.failedCourses}}</text>
        <text class="stat-label">ä¸é€šè¿‡</text>
      </view>
    </view>
    
    <!-- ç¬¬äºŒè¡Œç»Ÿè®¡ -->
    <view class="stats-row">
      <view class="stat-item">
        <text class="stat-value">{{gradeStats.avgGrade}}</text>
        <text class="stat-label">ç®—æœ¯å¹³å‡åˆ†</text>
      </view>
      <view class="stat-item">
        <text class="stat-value primary">{{gradeStats.weightedAvgGrade}}</text>
        <text class="stat-label">åŠ æƒå¹³å‡åˆ†</text>
      </view>
      <view class="stat-item">
        <text class="stat-value primary">{{gradeStats.gpa}}</text>
        <text class="stat-label">å¹³å‡å­¦åˆ†ç»©ç‚¹</text>
      </view>
    </view>
  </view>

  <!-- æˆç»©åˆ—è¡¨ -->
  <view class="grade-list" wx:if="{{gradeList.length > 0}}">
    <view 
      class="grade-item"
      wx:for="{{gradeList}}" 
      wx:key="index"
      bindtap="showGradeDetail"
      data-index="{{index}}"
    >
      <view class="course-info">
        <text class="course-name">{{item.courseName}}</text>
        <text class="course-details">
          <text class="course-credit">{{item.credit}}å­¦åˆ†</text>
          <text class="course-type" wx:if="{{item.courseType}}">{{item.courseType}}</text>
        </text>
        <text class="course-teacher" wx:if="{{item.teacher}}">ä»»è¯¾æ•™å¸ˆï¼š{{item.teacher}}</text>
      </view>      <view class="grade-info">
        <text class="grade-score {{item.gradeClass}}">{{item.totalScore || 'æœªå‡ºåˆ†'}}</text>
        <text class="grade-gpa" wx:if="{{item.gpa}}">ç»©ç‚¹ï¼š{{item.gpa}}</text>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{gradeList.length === 0 && !loading}}">
    <text class="empty-icon">ğŸ“Š</text>
    <text class="empty-text">æš‚æ— æˆç»©æ•°æ®</text>
    <button class="reload-btn" bindtap="loadGrades">é‡æ–°åŠ è½½</button>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
</view>
