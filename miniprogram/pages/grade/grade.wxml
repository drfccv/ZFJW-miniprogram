<!--æˆç»©æŸ¥è¯¢é¡µé¢-->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">æˆç»©æŸ¥è¯¢</text>
    <text class="update-time" wx:if="{{lastUpdateTime}}">{{lastUpdateTime}}</text>
  </view>

  <!-- å­¦æœŸé€‰æ‹©å™¨ -->
  <view class="term-selector"><!-- å­¦å¹´é€‰æ‹©å™¨ -->
    <picker
      class="hidden-picker" 
      mode="selector"
      range="{{yearRange}}"
      value="{{yearIndex}}"
      bindchange="onYearChange"
    >
      <view class="selector-item">
        <text class="selector-label">å­¦å¹´:</text>
        <text class="selector-value">{{yearRange[yearIndex]}}</text>
        <text class="selector-arrow">â–¼</text>
      </view>
    </picker><!-- å­¦æœŸé€‰æ‹©å™¨ -->
    <picker
      class="hidden-picker"
      mode="selector"
      range="{{['ç¬¬ä¸€å­¦æœŸ', 'ç¬¬äºŒå­¦æœŸ']}}"
      value="{{termIndex}}"
      bindchange="onTermChange"
    >
      <view class="selector-item">
        <text class="selector-label">å­¦æœŸ:</text>
        <text class="selector-value">{{termIndex === 0 ? 'ç¬¬ä¸€å­¦æœŸ' : 'ç¬¬äºŒå­¦æœŸ'}}</text>
        <text class="selector-arrow">â–¼</text>
      </view>
    </picker>

    <view class="refresh-btn" bindtap="refreshGrades">
      <text class="refresh-icon">ğŸ”„</text>
    </view>
  </view>
  <!-- æ–°å¢ï¼šæˆç»©æ¥å£ç±»å‹åˆ‡æ¢æç¤º -->
  <view class="api-type-bar">
    <text>æˆç»©æ¥å£ï¼š</text>
    <text class="api-type-value">{{gradeApiType === 'detail' ? 'è¯¦ç»†æˆç»©' : 'æ™®é€šæˆç»©'}}</text>
    <button class="api-type-btn" size="mini" bindtap="onGradeApiTypeChange" data-value="{{gradeApiType === 'detail' ? 'normal' : 'detail'}}">
      åˆ‡æ¢ä¸º{{gradeApiType === 'detail' ? 'æ™®é€š' : 'è¯¦ç»†'}}
    </button>
  </view>

  <!-- æˆç»©ç»Ÿè®¡ -->
  <view class="grade-stats" wx:if="{{gradeList.length > 0}}">
    <!-- ç¬¬ä¸€è¡Œç»Ÿè®¡ -->
    <view class="stats-row">
      <view class="stat-item">
        <text class="stat-value">{{gradeStats.totalCourses}}</text>
        <text class="stat-label">æ€»ç§‘ç›®</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{gradeStats.passedCourses}}</text>
        <text class="stat-label">é€šè¿‡</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{gradeStats.failedCourses}}</text>
        <text class="stat-label">ä¸é€šè¿‡</text>
      </view>
    </view>
    
    <!-- ç¬¬äºŒè¡Œç»Ÿè®¡ -->
    <view class="stats-row">
      <view class="stat-item">
        <text class="stat-value">{{gradeStats.avgGrade}}</text>
        <text class="stat-label">ç®—æœ¯å¹³å‡åˆ†</text>
      </view>
      <view class="stat-item">
        <text class="stat-value primary">{{gradeStats.weightedAvgGrade}}</text>
        <text class="stat-label">åŠ æƒå¹³å‡åˆ†</text>
      </view>
      <view class="stat-item">
        <text class="stat-value primary">{{gradeStats.gpa}}</text>
        <text class="stat-label">å¹³å‡å­¦åˆ†ç»©ç‚¹</text>
      </view>
    </view>
  </view>

  <!-- æˆç»©åˆ—è¡¨ -->
  <view class="grade-list" wx:if="{{gradeList.length > 0}}">
    <view 
      class="grade-item"
      wx:for="{{gradeList}}" 
      wx:key="index"
      data-index="{{index}}"
      bindtap="showGradeDetail"
    >
      <view class="course-info">
        <text class="course-name">{{item.courseName}}</text>
        <!-- æ™®é€šæ¨¡å¼ä¸‹å°æ ‡ç­¾ï¼ˆç±»å‹ã€å­¦åˆ†ã€ç»©ç‚¹ç»Ÿä¸€é£æ ¼ï¼‰ -->
        <block wx:if="{{gradeApiType === 'normal'}}">
          <view class="course-tags">
            <text class="tag-type" wx:if="{{item.courseType}}">{{item.courseType}}</text>
            <text class="tag-credit">å­¦åˆ†: {{item.credit}}</text>
            <text class="tag-gpa" wx:if="{{item.gpa}}">ç»©ç‚¹: {{item.gpa}}</text>
          </view>
        </block>
        <!-- è¯¦ç»†æ¨¡å¼ä¸‹å°æ ‡ç­¾ï¼ˆåªæ˜¾ç¤ºå¼€è¯¾å­¦é™¢å’Œå­¦åˆ†ï¼‰ -->
        <block wx:if="{{gradeApiType === 'detail'}}">
          <view class="course-tags">
            <text class="tag-college" wx:if="{{item.startCollege}}">{{item.startCollege}}</text>
            <text class="tag-credit">å­¦åˆ†: {{item.credit}}</text>
          </view>
        </block>
      </view>
      <view class="grade-info align-right">
        <view class="score-badge {{item.gradeClass}}">{{item.totalScore || 'æœªå‡ºåˆ†'}}</view>
      </view>
      <!-- è¯¦ç»†æˆç»©æ¨¡å¼ä¸‹ï¼šå–æ¶ˆå±•å¼€æ˜ç»†ï¼Œç‚¹å‡»å¡ç‰‡å¼¹çª—æ˜¾ç¤ºæ‰€æœ‰æ˜ç»† -->
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{gradeList.length === 0 && !loading}}">
    <text class="empty-icon">ğŸ“Š</text>
    <text class="empty-text">æš‚æ— æˆç»©æ•°æ®</text>
    <button class="reload-btn" bindtap="loadGrades">é‡æ–°åŠ è½½</button>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
</view>
