<!--é€‰è¯¾ç®¡ç†é¡µé¢-->
<view class="container">
  <!-- é€‰é¡¹å¡ -->
  <view class="tab-bar">
    <view 
      class="tab-item {{currentTab === 0 ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="0"
    >
      å·²é€‰è¯¾ç¨‹
    </view>
    <view 
      class="tab-item {{currentTab === 1 ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="1"
    >
      å¯é€‰è¯¾ç¨‹
    </view>
  </view>  <!-- å­¦æœŸé€‰æ‹©å™¨ -->
  <view class="term-selector">
    <picker 
      mode="selector"
      range="{{yearRange}}"
      value="{{yearIndex}}"
      bindchange="onYearChange"
    >
      <view class="selector-item">
        <text class="selector-label">å­¦å¹´:</text>
        <text class="selector-value">{{yearRange[yearIndex] || 'è¯·é€‰æ‹©å­¦å¹´'}}</text>
        <text class="selector-arrow">â–¼</text>
      </view>
    </picker>
    
    <picker 
      mode="selector"
      range="{{['ç¬¬ä¸€å­¦æœŸ', 'ç¬¬äºŒå­¦æœŸ']}}"
      value="{{termIndex}}"
      bindchange="onTermChange"
    >
      <view class="selector-item">
        <text class="selector-label">å­¦æœŸ:</text>
        <text class="selector-value">{{currentTerm === 1 ? 'ç¬¬ä¸€å­¦æœŸ' : 'ç¬¬äºŒå­¦æœŸ'}}</text>
        <text class="selector-arrow">â–¼</text>
      </view>
    </picker>
    
    <view class="refresh-btn" bindtap="refreshCourses">
      <text class="refresh-icon">ğŸ”„</text>
    </view>
  </view>
  <!-- å·²é€‰è¯¾ç¨‹åˆ—è¡¨ -->
  <view class="course-list" wx:if="{{currentTab === 0}}">
    <view 
      class="course-item selected-course"
      wx:for="{{selectedCourses}}" 
      wx:key="index"
    >
      <view class="course-main">
        <view class="course-info">
          <view class="course-header">
            <text class="course-name">{{item.courseName}}</text>
          </view>          <view class="course-details">
            <text class="course-info-tag course-credit">{{item.credit}}å­¦åˆ†</text>
            <text class="course-info-tag course-teacher" wx:if="{{item.teacher && item.teacher.length <= 8}}">{{item.teacher}}</text>
            <text class="course-info-tag course-teacher" wx:elif="{{item.teacher}}">{{item.teacher.substring(0, 6)}}...</text>
          </view>
          <view class="course-extra-info" wx:if="{{item.time || item.location}}">
            <text class="course-time" wx:if="{{item.time}}">ğŸ•’ {{item.time}}</text>
            <text class="course-location" wx:if="{{item.location}}">ğŸ“ {{item.location}}</text>
          </view>
        </view>
        <view class="course-actions">
          <button 
            class="action-btn drop-btn"
            bindtap="dropCourse"
            data-course="{{item}}"
            data-index="{{index}}"
          >
            é€€è¯¾
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- å¯é€‰è¯¾ç¨‹åˆ—è¡¨ -->
  <view class="course-list" wx:if="{{currentTab === 1}}">
    <!-- æ¿å—é€‰æ‹©å™¨ -->
    <view class="block-selector" wx:if="{{blockList.length > 0}}">
      <scroll-view scroll-x class="block-scroll">
        <view class="block-list">
          <view 
            class="block-item {{currentBlock === item.id ? 'active' : ''}}"
            wx:for="{{blockList}}" 
            wx:key="id"
            bindtap="selectBlock"
            data-block="{{item.id}}"
          >
            {{item.name}}
          </view>
        </view>
      </scroll-view>
    </view>    <!-- å¯é€‰è¯¾ç¨‹ -->
    <view 
      class="course-item available-course"
      wx:for="{{availableCourses}}" 
      wx:key="index"
    >
      <!-- è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯ -->
      <view class="course-main" bindtap="toggleCourseExpansion" data-index="{{index}}">
        <view class="course-info">
          <view class="course-header">
            <text class="course-name">{{item.courseName}}</text>
            <text class="expand-icon">{{item.isExpanded ? 'â–¼' : 'â–¶'}}</text>
          </view>          <view class="course-details">
            <text class="course-info-tag course-credit">{{item.credit}}å­¦åˆ†</text>
            <text class="course-info-tag course-available {{item.available <= 0 ? 'full' : ''}}" wx:if="{{item.available !== undefined}}">
              {{item.available <= 0 ? 'å·²æ»¡' : (item.available > 999 ? '999+' : 'å‰©' + item.available)}}
            </text>
            <text class="course-info-tag course-class-count" wx:if="{{item.classCount > 0}}">
              {{item.classCount > 99 ? '99+ç­' : item.classCount + 'ç­'}}
            </text>
          </view>
        </view>        <view class="course-actions">
          <button 
            class="action-btn select-btn"
            bindtap="selectCourse"
            data-course="{{item}}"
            data-index="{{index}}"
            catch:tap="onSelectCourseTap"
          >
            é€‰è¯¾
          </button>
        </view>
      </view>
      
      <!-- æ•™å­¦ç­åˆ—è¡¨ - å‘ä¸‹å±•å¼€ -->
      <view class="class-list-container" wx:if="{{item.isExpanded}}">
        <view class="class-list-header">
          <text class="class-list-title">å¯é€‰æ•™å­¦ç­</text>
          <text class="class-count" wx:if="{{item.classes && item.classes.length > 0}}">
            å…±{{item.classes.length}}ä¸ªæ•™å­¦ç­
          </text>
        </view>
        
        <view class="class-list" wx:if="{{item.classes && item.classes.length > 0}}">
          <view 
            class="class-item"
            wx:for="{{item.classes}}" 
            wx:for-item="cls"
            wx:for-index="classIndex"
            wx:key="classId"
          >
            <view class="class-info">
              <view class="class-header">
                <text class="class-name">{{cls.className || 'æ•™å­¦ç­' + (classIndex + 1)}}</text>                <view class="class-status">
                  <text class="course-info-tag course-teacher">{{cls.selectedNumber}}/{{cls.capacity}}</text>
                  <text class="course-info-tag course-available" wx:if="{{cls.available > 0}}">
                    {{cls.available > 99 ? '99+' : 'å‰©' + cls.available}}
                  </text>
                  <text class="course-info-tag course-available full" wx:else>å·²æ»¡</text>
                </view>
              </view>
              <view class="class-details">
                <text class="class-teacher" wx:if="{{cls.teacher}}">ğŸ‘¨â€ğŸ« {{cls.teacher}}</text>
                <text class="class-time" wx:if="{{cls.time && cls.time !== '--'}}">ğŸ•’ {{cls.time}}</text>
                <text class="class-location" wx:if="{{cls.place && cls.place !== '--'}}">ğŸ“ {{cls.place}}</text>
              </view>
            </view>
            <view class="class-actions">
              <button 
                class="action-btn class-select-btn {{cls.available <= 0 || !cls.optional ? 'disabled' : ''}}"
                bindtap="selectCourseClass"
                data-course-index="{{index}}"
                data-class-index="{{classIndex}}"
                disabled="{{!cls.optional || cls.available <= 0}}"
              >
                {{!cls.optional ? 'ä¸å¯é€‰' : (cls.available <= 0 ? 'å·²æ»¡' : 'é€‰è¯¾')}}
              </button>
            </view>
          </view>
        </view>
        
        <view class="class-empty" wx:else>
          <text class="empty-text">æš‚æ— æ•™å­¦ç­ä¿¡æ¯</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{getCurrentList().length === 0 && !loading}}">
    <text class="empty-icon">ğŸ“š</text>
    <text class="empty-text">{{currentTab === 0 ? 'æš‚æ— å·²é€‰è¯¾ç¨‹' : 'æš‚æ— å¯é€‰è¯¾ç¨‹'}}</text>
    <button class="reload-btn" bindtap="loadCurrentData">é‡æ–°åŠ è½½</button>
  </view>
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
</view>
