<!--è¯¾è¡¨é¡µé¢-->
<view class="container">
  <!-- å½“å‰å‘¨æ¬¡æ˜¾ç¤º -->
  <view class="current-week-display">
    <text class="current-week-text">ç¬¬{{currentWeek}}å‘¨è¯¾è¡¨</text>
    <text class="swipe-hint">å·¦å³æ»‘åŠ¨åˆ‡æ¢å‘¨æ¬¡</text>
  </view>

  <!-- è¯¾è¡¨è¡¨æ ¼ -->
  <view class="schedule-wrapper" 
        bindtouchstart="onTouchStart" 
        bindtouchend="onTouchEnd">
    <scroll-view class="schedule-container" scroll-y wx:if="{{scheduleData.length > 0}}">    <!-- è¡¨å¤´ -->
    <view class="schedule-header">
      <!-- æ—¶é—´åˆ—å¤´ -->
      <view class="time-column-header">
        <text class="time-header-text">èŠ‚æ¬¡</text>
      </view>
      <!-- æ—¥æœŸåˆ—å¤´ -->
      <view class="day-header" wx:for="{{dayHeaders}}" wx:key="index">
        <text class="day-name">{{item.name}}</text>
        <text class="day-date">{{item.date}}</text>
      </view>
    </view><!-- è¯¾è¡¨å†…å®¹ -->
    <view class="schedule-body {{animationClass}}">      <view 
        class="schedule-row" 
        style="height: max(calc((100vh - 300rpx) / {{maxPeriods}}), 80rpx);"
        wx:for="{{mergedScheduleGrid}}" 
        wx:key="index" 
        wx:for-item="timeSlot" 
        wx:for-index="periodIndex"
      ><!-- æ—¶é—´åˆ— -->
        <view class="time-column">
          <text class="time-period">{{periodIndex + 1}}</text>
        </view>
        
        <!-- è¯¾ç¨‹å•å…ƒæ ¼ -->
        <view class="day-column" wx:for="{{dayHeaders}}" wx:key="dayIndex" wx:for-item="day" wx:for-index="dayIndex"><!-- æœ‰è¯¾ç¨‹ä¸”æ˜¯ç¬¬ä¸€èŠ‚æ—¶æ˜¾ç¤ºå®Œæ•´è¯¾ç¨‹ä¿¡æ¯ -->          <view 
            wx:if="{{timeSlot[dayIndex] && timeSlot[dayIndex].isFirst}}"
            class="course-cell has-course {{timeSlot[dayIndex].isMerged ? 'merged-course' : ''}}"
            style="{{timeSlot[dayIndex].isMerged ? 'height: calc(' + timeSlot[dayIndex].periods + ' * max(((100vh - 300rpx) / ' + maxPeriods + '), 80rpx));' : ''}}"
            bindtap="showCourseDetail"
            data-course="{{timeSlot[dayIndex]}}"
          >
            <view class="course-content">
              <text class="course-name">{{timeSlot[dayIndex].title}}</text>
              <text class="course-location">{{timeSlot[dayIndex].place}}</text>
              <text class="course-teacher">{{timeSlot[dayIndex].teacher}}</text>
            </view>
          </view>
          
          <!-- å ä½æ ¼å­ï¼šç”¨äºè¿å ‚è¯¾çš„åç»­èŠ‚æ¬¡ï¼Œä¿æŒç»“æ„ä½†é€æ˜ -->
          <view 
            wx:elif="{{timeSlot[dayIndex] && timeSlot[dayIndex].isPlaceholder}}"
            class="course-cell placeholder-cell"
          >
          </view>
          
          <!-- ç©ºæ ¼å­ -->
          <view 
            wx:else
            class="course-cell empty-cell"
          >
          </view>
        </view>
      </view>
    </view>
  </scroll-view>
  
  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{scheduleData.length === 0 && !loading}}">
    <text class="empty-icon">ğŸ“…</text>    <text class="empty-text">æš‚æ— è¯¾è¡¨æ•°æ®</text>
    <button class="reload-btn" bindtap="loadSchedule">é‡æ–°åŠ è½½</button>
  </view>
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  </view> <!-- ç»“æŸ schedule-wrapper -->
</view>

<!-- è¯¾ç¨‹è¯¦æƒ…å¼¹çª— -->
<view class="course-detail-modal" wx:if="{{showCourseDetailModal && courseDetail}}" bindtap="hideCourseDetail">
  <view class="course-detail-content" catchtap="">
    <view class="course-detail-header">
      <text class="course-detail-title">è¯¾ç¨‹è¯¦æƒ…</text>
      <text class="course-detail-close" bindtap="hideCourseDetail">âœ•</text>
    </view>
    <view class="course-detail-body">
      <view class="course-detail-item">
        <text class="detail-label">è¯¾ç¨‹åç§°ï¼š</text>
        <text class="detail-value">{{courseDetail.title}}</text>
      </view>
      <view class="course-detail-item">
        <text class="detail-label">æˆè¯¾æ•™å¸ˆï¼š</text>
        <text class="detail-value">{{courseDetail.teacher}}</text>
      </view>
      <view class="course-detail-item">
        <text class="detail-label">ä¸Šè¯¾åœ°ç‚¹ï¼š</text>
        <text class="detail-value">{{courseDetail.place}}</text>
      </view>
      <view class="course-detail-item">
        <text class="detail-label">ä¸Šè¯¾æ—¶é—´ï¼š</text>
        <text class="detail-value">{{courseDetail.time}}</text>
      </view>
      <view class="course-detail-item">
        <text class="detail-label">ä¸Šè¯¾å‘¨æ¬¡ï¼š</text>
        <text class="detail-value">{{courseDetail.weeks}}</text>
      </view>
      <view class="course-detail-item">
        <text class="detail-label">å­¦åˆ†ï¼š</text>
        <text class="detail-value">{{courseDetail.credit}}</text>
      </view>
      <view class="course-detail-item">
        <text class="detail-label">æ€»å­¦æ—¶ï¼š</text>
        <text class="detail-value">{{courseDetail.total_hours}}</text>
      </view>
    </view>
    <view class="course-detail-footer">
      <button class="detail-confirm-btn" bindtap="hideCourseDetail">ç¡®å®š</button>
    </view>
  </view>
</view>